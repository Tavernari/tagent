name: "cnpj_enrichment_v2"
description: "Comprehensive CNPJ enrichment workflow with reputation analysis, website validation, and social media presence"
version: "1.0"

initial_context:
  cnpj: "{{ input.cnpj }}"
  razao_social: "{{ input.razao_social }}"

groups:
  - name: "first_line_research"
    execution_mode: "parallel"
    timeout: 300
    min_success_rate: 0.5  # At least 1 of 2 required agents must succeed
    summary_prompt: "Based on searches from Reclame Aqui and Glassdoor, summarize the general sentiment and main attention points about company {{ razao_social }}."
    agents:
      - name: "reclame_aqui"
        required: true
        timeout: 180
        retry_count: 2
        retry_delay: 5.0
        tool_config:
          tools: ["web_search"]
          prompt: "Search for complaints about company '{{ razao_social }}' (CNPJ {{ cnpj }}) on Reclame Aqui. Focus on general reputation and recurring problems."
          model: "gpt-4-turbo"
          temperature: 0.3

      - name: "glassdoor"
        required: true
        timeout: 180
        retry_count: 2
        retry_delay: 5.0
        tool_config:
          tools: ["web_search"]
          prompt: "Search for reviews of company '{{ razao_social }}' on Glassdoor. Focus on culture and employee satisfaction."
          model: "gpt-4-turbo"
          temperature: 0.3

      - name: "key_people_search"
        required: false  # Optional agent, failure doesn't impact success_rate
        timeout: 120
        tool_config:
          tools: ["linkedin_search"]
          prompt: "Find key executives (C-level) associated with company '{{ razao_social }}'."
          model: "gpt-4-turbo"
          temperature: 0.5

  - name: "website_validation"
    execution_mode: "sequential"
    timeout: 400
    agents:
      - name: "official_website_finder"
        timeout: 200
        tool_config:
          tools: ["web_search"]
          prompt: "Find the official website of company '{{ razao_social }}'."
          model: "gpt-4-turbo"
          temperature: 0.2

      - name: "website_scraper"
        timeout: 180
        tool_config:
          tools: ["web_scraper"]
          # Result from previous agent can be injected into the next agent's prompt
          prompt: "Analyze the content of website {{ results.website_validation.official_website_finder.url }} to validate if it belongs to the company and extract contact information."
          model: "gpt-4-turbo"
          temperature: 0.1

  - name: "social_media_presence"
    # This group only executes if a valid website was found in the previous group
    condition: "results.website_validation.website_scraper.is_valid == True"
    execution_mode: "parallel"
    timeout: 250
    summary_prompt: "Summarize the company's presence and engagement on social media."
    agents:
      - name: "linkedin"
        timeout: 120
        tool_config:
          tools: ["linkedin_search"]
          prompt: "Search for the official profile of company '{{ razao_social }}' on LinkedIn."
          model: "gpt-4-turbo"
          temperature: 0.4

      - name: "facebook"
        required: false
        timeout: 120
        tool_config:
          tools: ["web_search"]
          prompt: "Search for the official Facebook page of company '{{ razao_social }}'."
          model: "gpt-4-turbo"
          temperature: 0.4

      - name: "instagram"
        required: false
        timeout: 120
        tool_config:
          tools: ["web_search"]
          prompt: "Search for the official Instagram profile of company '{{ razao_social }}'."
          model: "gpt-4-turbo"
          temperature: 0.4

final_summary_prompt: "Generate a comprehensive enrichment report for CNPJ {{ cnpj }}, consolidating the reputation data, website information, and social media presence collected."

global_timeout: 1200  # 20 minutes maximum for entire workflow

metadata:
  version: "2.0"
  author: "TAgent Community"
  created_date: "2025-01-15"
  tags: ["cnpj", "enrichment", "business-intelligence"]
  description: "Advanced CNPJ enrichment workflow with conditional execution and parallel processing"